<diagram program="umletino" version="15.1"><zoom_level>10</zoom_level><element><id>UMLClass</id><coordinates><x>300</x><y>86</y><w>360</w><h>370</h></coordinates><panel_attributes>Main (singleton)
--
- list of connections
- name of the user (ask user)
- two shared info things
     One for talking to user about party requests
     One for talking to user about party answers
- lock for talking to user about party requests
- boolean to indicate if node is 
   trying to host a playing party
- lock por playing party actions
- Has music player
- variable storing whether the user has not 
   heard from the host of playing party (heartbeat)
- the amount of time that is needed for a message to reach all 
   playing party members
-
- join  network
- show playing party request 
    (method that connection can call) 
    ((needs lock))
- create playing party
- send request to all connections
- add action (creates change, sends message, 
  adds change to player thread)</panel_attributes><additional_attributes></additional_attributes></element><element><id>UMLClass</id><coordinates><x>920</x><y>746</y><w>290</w><h>100</h></coordinates><panel_attributes>/connection/
--
- name (who you are connected to)
- socket (mySocket)
--
- mutate (receives party con, returns P2P con)
- mutate (receives P2P con, returns party con)</panel_attributes><additional_attributes></additional_attributes></element><element><id>UMLClass</id><coordinates><x>570</x><y>1026</y><w>270</w><h>120</h></coordinates><panel_attributes>host connection
--
- run (for host)
- sendActionRequest (adds change to 
    music player (with main method) and sends
    action message to members</panel_attributes><additional_attributes></additional_attributes></element><element><id>UMLClass</id><coordinates><x>870</x><y>1026</y><w>270</w><h>120</h></coordinates><panel_attributes>member connection
--
- run (as member. when it gets a request, 
         add change to main's music player)
- sendActionRequest (sends an action 
           request to the host)</panel_attributes><additional_attributes></additional_attributes></element><element><id>Relation</id><coordinates><x>800</x><y>956</y><w>30</w><h>90</h></coordinates><panel_attributes>lt=&lt;&lt;-</panel_attributes><additional_attributes>10;10;10;70</additional_attributes></element><element><id>Relation</id><coordinates><x>910</x><y>956</y><w>30</w><h>90</h></coordinates><panel_attributes>lt=&lt;&lt;-</panel_attributes><additional_attributes>10;10;10;70</additional_attributes></element><element><id>UMLClass</id><coordinates><x>830</x><y>346</y><w>250</w><h>100</h></coordinates><panel_attributes>music player
--
- list of songs
- media player (thing that plays music)
-
- playing methods</panel_attributes><additional_attributes></additional_attributes></element><element><id>UMLClass</id><coordinates><x>780</x><y>126</y><w>230</w><h>90</h></coordinates><panel_attributes>SharedInfo
--
- lock
- answer
- waiting_connection
--

</panel_attributes><additional_attributes></additional_attributes></element><element><id>UMLClass</id><coordinates><x>1150</x><y>306</y><w>250</w><h>100</h></coordinates><panel_attributes>music player thread
--
- list of changes
- music player
-
- add change method
- create update method</panel_attributes><additional_attributes></additional_attributes></element><element><id>UMLClass</id><coordinates><x>1270</x><y>166</y><w>250</w><h>90</h></coordinates><panel_attributes>update
--
- play/pause
- UTC time of action
- song and timestamp
- number of updates at time of sending</panel_attributes><additional_attributes></additional_attributes></element><element><id>UMLUseCase</id><coordinates><x>1100</x><y>96</y><w>710</w><h>410</h></coordinates><panel_attributes>TBD by whomever does the player</panel_attributes><additional_attributes></additional_attributes></element><element><id>UMLClass</id><coordinates><x>1430</x><y>336</y><w>150</w><h>110</h></coordinates><panel_attributes>&lt;&lt;enum&gt;&gt; action
--
+ play, pause, skip, etc
--
- action name
- action function</panel_attributes><additional_attributes></additional_attributes></element><element><id>Relation</id><coordinates><x>650</x><y>226</y><w>470</w><h>100</h></coordinates><panel_attributes>lt=&lt;-</panel_attributes><additional_attributes>450;80;10;10</additional_attributes></element><element><id>UMLClass</id><coordinates><x>740</x><y>896</y><w>270</w><h>70</h></coordinates><panel_attributes>/party connection/
--
--
- abstract sendActionRequest</panel_attributes><additional_attributes></additional_attributes></element><element><id>Relation</id><coordinates><x>970</x><y>836</y><w>30</w><h>80</h></coordinates><panel_attributes>lt=&lt;&lt;-</panel_attributes><additional_attributes>10;10;10;60</additional_attributes></element><element><id>UMLClass</id><coordinates><x>0</x><y>826</y><w>230</w><h>90</h></coordinates><panel_attributes>Host heartbeat (implements thread)
--
--
- run


</panel_attributes><additional_attributes></additional_attributes></element><element><id>UMLClass</id><coordinates><x>260</x><y>826</y><w>230</w><h>90</h></coordinates><panel_attributes>Member hearbeat (implements thread)
--
--
- run


</panel_attributes><additional_attributes></additional_attributes></element><element><id>UMLNote</id><coordinates><x>1550</x><y>156</y><w>170</w><h>120</h></coordinates><panel_attributes>The number of changes
is added so that the nodes
can check who is more
updated: them or the 
heartbeat. That is, if the 
heartbeat has less changes
than them, ignore
bg=blue</panel_attributes><additional_attributes></additional_attributes></element><element><id>UMLNote</id><coordinates><x>300</x><y>466</y><w>370</w><h>190</h></coordinates><panel_attributes>Heartbeat thread wakes up
If it has heard from the host recently enough, back to sleep
If too long has passed, it will change the variable in the main, 
to indicate to the main that the host has been disconnected
and it will print "Disconnected from  the host, continue playing
party?" for the user. After this, closes the thread 
(it finishes its execution)

On the side of the main:

gets a yes/no and checks if it is related to heartbeat. 
act accordingly
bg=yellow</panel_attributes><additional_attributes></additional_attributes></element><element><id>UMLClass</id><coordinates><x>140</x><y>696</y><w>230</w><h>90</h></coordinates><panel_attributes>/hearbeat (implements thread)/
--
- stores the time of the latest update
--
- lastUpdate(receives a time)


</panel_attributes><additional_attributes></additional_attributes></element><element><id>Relation</id><coordinates><x>290</x><y>776</y><w>30</w><h>70</h></coordinates><panel_attributes>lt=&lt;&lt;-</panel_attributes><additional_attributes>10;10;10;50</additional_attributes></element><element><id>Relation</id><coordinates><x>170</x><y>776</y><w>30</w><h>70</h></coordinates><panel_attributes>lt=&lt;&lt;-</panel_attributes><additional_attributes>10;10;10;50</additional_attributes></element><element><id>UMLNote</id><coordinates><x>0</x><y>936</y><w>230</w><h>120</h></coordinates><panel_attributes>Heartbeat thread wakes up
If it has sent a message recently 
enough, back to sleep
If too long has passed, send a 
message with the expected song 
and timestamp and UTC time to 
the members
bg=yellow</panel_attributes><additional_attributes></additional_attributes></element><element><id>UMLClass</id><coordinates><x>1100</x><y>896</y><w>260</w><h>90</h></coordinates><panel_attributes>P2P connection (it is a thread)
--
- response time (calculates somehow)
--
- run (listens on the socket)
# (class method) get max response time</panel_attributes><additional_attributes></additional_attributes></element><element><id>Relation</id><coordinates><x>1120</x><y>836</y><w>30</w><h>80</h></coordinates><panel_attributes>lt=&lt;&lt;-</panel_attributes><additional_attributes>10;10;10;60</additional_attributes></element></diagram>